<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Videos | Ginger Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/admin.css">
<style>
:root{--navy:#0B2545;--teal:#0EA5A0;--ginger:#F26522;--gray-50:#F9FAFB;--gray-100:#F3F4F6;--gray-200:#E5E7EB;--gray-300:#D1D5DB;--gray-400:#9CA3AF;--gray-500:#6B7280;--gray-600:#4B5563}
.data-table{width:100%;border-collapse:collapse}.data-table th{font-size:.72rem;text-transform:uppercase;letter-spacing:.5px;color:var(--gray-500);font-weight:700;padding:8px 10px;border-bottom:2px solid var(--gray-200);text-align:left;white-space:nowrap;cursor:pointer;user-select:none}.data-table th:hover{color:var(--navy)}.data-table td{padding:8px 10px;border-bottom:1px solid var(--gray-100);font-size:.85rem;vertical-align:middle}.data-table tr:hover td{background:var(--gray-50)}
.row-actions{display:flex;gap:4px;margin-top:4px;opacity:0;transition:opacity .15s}tr:hover .row-actions{opacity:1}.row-actions button{font-size:.72rem;padding:2px 7px;border-radius:3px;cursor:pointer;font-family:inherit;border:none;background:none;color:var(--gray-500)}.row-actions button:hover{color:var(--teal)}.row-actions .act-del{color:#EF4444}.row-actions .act-del:hover{color:#DC2626}
.badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:.72rem;font-weight:600}.badge--published{background:#D1FAE5;color:#059669}.badge--draft{background:#FEF3C7;color:#D97706}
.btn-new{display:inline-flex;align-items:center;gap:5px;padding:7px 16px;background:var(--teal);color:#fff;border:none;border-radius:6px;font-size:.85rem;font-weight:700;cursor:pointer;font-family:inherit;transition:background .2s}.btn-new:hover{background:#0c918c}
.empty-state{text-align:center;padding:40px;color:var(--gray-400);font-size:.92rem}
.thumb-cell{width:120px}.thumb-cell img{width:110px;height:62px;object-fit:cover;border-radius:6px;border:1px solid var(--gray-200)}
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);z-index:9999;display:none;align-items:center;justify-content:center;padding:20px}.modal-overlay.open{display:flex}.modal{background:#fff;border-radius:12px;width:100%;max-width:640px;max-height:85vh;overflow-y:auto;box-shadow:0 20px 60px rgba(0,0,0,.3)}.modal__header{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-bottom:1px solid var(--gray-200)}.modal__header h3{font-family:'Playfair Display',serif;color:var(--navy);font-size:1.1rem;margin:0}.modal__close{background:none;border:none;font-size:1.3rem;cursor:pointer;color:var(--gray-400);padding:4px 8px;border-radius:6px}.modal__close:hover{background:var(--gray-100);color:var(--navy)}.modal__body{padding:20px 24px}.modal__footer{display:flex;gap:8px;justify-content:flex-end;padding:16px 24px;border-top:1px solid var(--gray-200)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:14px}.form-group{margin-bottom:14px}.form-label{font-size:.78rem;font-weight:700;color:var(--navy);margin-bottom:4px;display:block}.form-input,.form-select,.form-textarea{width:100%;padding:8px 12px;border:1.5px solid var(--gray-200);border-radius:6px;font-family:inherit;font-size:.85rem;box-sizing:border-box}.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--teal);outline:none}.form-textarea{resize:vertical;min-height:80px}
.thumb-preview{width:100%;max-width:320px;border-radius:8px;margin-top:8px;border:1px solid var(--gray-200);display:none}
.search-wrap{flex:1;max-width:260px;position:relative}.search-wrap input{width:100%;padding:6px 10px 6px 30px;border:1px solid var(--gray-300);border-radius:5px;font-size:.82rem;font-family:inherit}.search-wrap input:focus{outline:none;border-color:var(--teal)}.search-wrap::before{content:'üîç';position:absolute;left:8px;top:50%;transform:translateY(-50%);font-size:.75rem}
</style>
<script src="/js/sidebar.js" defer></script>
</head>
<body><div class="layout"><aside class="sidebar" id="sidebar"></aside>
<main class="main"><header class="topbar"><button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button><h1 class="topbar__title" id="pageTitle">Videos</h1><div class="topbar__actions"><button class="btn-new" onclick="openModal()">+ Add Video</button></div></header>
<div class="content">
    <div style="display:flex;gap:10px;margin-bottom:14px;align-items:center">
        <div class="search-wrap"><input type="text" placeholder="Search videos..." id="searchInput" oninput="doFilter()"></div>
    </div>
    <div class="card"><div class="card__body" style="padding:0;overflow-x:auto">
        <table class="data-table"><thead><tr><th>Thumbnail</th><th>Title</th><th>Doctor</th><th>Hospital</th><th>Specialty</th><th>Featured</th><th>Status</th><th>Date</th></tr></thead><tbody id="list"><tr><td colspan="8" class="empty-state">Loading...</td></tr></tbody></table>
    </div></div>
</div></main></div>

<div class="modal-overlay" id="modal"><div class="modal">
    <div class="modal__header"><h3 id="modalTitle">Add Video</h3><button class="modal__close" onclick="closeModal()">‚úï</button></div>
    <div class="modal__body">
        <div class="form-group"><label class="form-label">Title *</label><input class="form-input" id="f_title" oninput="autoSlug()"></div>
        <div class="form-row"><div class="form-group"><label class="form-label">Slug</label><input class="form-input" id="f_slug"></div><div class="form-group"><label class="form-label">Sort Order</label><input class="form-input" type="number" id="f_sort_order" value="0"></div></div>
        <div class="form-group"><label class="form-label">YouTube URL *</label><input class="form-input" id="f_youtube_url" placeholder="https://www.youtube.com/watch?v=..." oninput="autoThumb()"><img class="thumb-preview" id="thumbPreview"></div>
        <div class="form-group"><label class="form-label">Thumbnail URL (auto-generated from YouTube)</label><input class="form-input" id="f_thumbnail"></div>
        <div class="form-row"><div class="form-group"><label class="form-label">Doctor</label><select class="form-select" id="f_doctor_id"><option value="">‚Äî None ‚Äî</option></select></div><div class="form-group"><label class="form-label">Hospital</label><select class="form-select" id="f_hospital_id"><option value="">‚Äî None ‚Äî</option></select></div></div>
        <div class="form-row"><div class="form-group"><label class="form-label">Specialty</label><select class="form-select" id="f_specialty_id"><option value="">‚Äî None ‚Äî</option></select></div><div class="form-group"><label class="form-label">Treatment</label><select class="form-select" id="f_treatment_id"><option value="">‚Äî None ‚Äî</option></select></div></div>
        <div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f_description" rows="3"></textarea></div>
        <div class="form-row"><div class="form-group"><label class="form-label">Is Featured</label><select class="form-select" id="f_featured"><option value="false">No</option><option value="true">Yes</option></select></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f_status"><option value="draft">Draft</option><option value="published">Published</option></select></div></div>
    </div>
    <div class="modal__footer"><button class="btn btn--outline" onclick="closeModal()">Cancel</button><button class="btn btn--primary" onclick="saveItem()">Save Video</button></div>
</div></div>

<script>
let items=[],editId=null,allDoctors=[],allHospitals=[],allSpecialties=[],allTreatments=[];
const API='/api/videos';
async function safeFetch(u,o){for(let i=0;i<3;i++){try{const r=await fetch(u,o);if(r.status===429){await new Promise(ok=>setTimeout(ok,1000*(i+1)));continue;}return r;}catch(e){if(i===2)throw e;await new Promise(ok=>setTimeout(ok,1000));}}}
async function loadDropdowns(){try{const[dr,hr,sr,tr]=await Promise.all([safeFetch('/api/doctors'),safeFetch('/api/hospitals'),safeFetch('/api/specialties'),safeFetch('/api/treatments')]);allDoctors=await dr.json();allHospitals=await hr.json();allSpecialties=await sr.json();allTreatments=await tr.json();document.getElementById('f_doctor_id').innerHTML='<option value="">‚Äî None ‚Äî</option>'+allDoctors.map(d=>`<option value="${d.id}">${d.name}</option>`).join('');document.getElementById('f_hospital_id').innerHTML='<option value="">‚Äî None ‚Äî</option>'+allHospitals.map(h=>`<option value="${h.id}">${h.name}</option>`).join('');document.getElementById('f_specialty_id').innerHTML='<option value="">‚Äî None ‚Äî</option>'+allSpecialties.map(s=>`<option value="${s.id}">${s.name}</option>`).join('');document.getElementById('f_treatment_id').innerHTML='<option value="">‚Äî None ‚Äî</option>'+allTreatments.map(t=>`<option value="${t.id}">${t.name}</option>`).join('');}catch(e){console.error('Dropdown load failed',e);}}
async function load(){try{const r=await safeFetch(API);if(!r||!r.ok)return;items=await r.json();document.getElementById('pageTitle').textContent='Videos ('+items.length+')';doFilter();}catch(e){document.getElementById('list').innerHTML='<tr><td colspan="8" class="empty-state">Error loading.</td></tr>';}}
function doFilter(){const q=document.getElementById('searchInput').value.toLowerCase();const f=items.filter(i=>!q||i.title.toLowerCase().includes(q)||(i.doctor_name||'').toLowerCase().includes(q)||(i.hospital_name||'').toLowerCase().includes(q)||(i.specialty_name||'').toLowerCase().includes(q));render(f);}
function esc(s){const d=document.createElement('div');d.textContent=s;return d.innerHTML;}
function getYTId(url){if(!url)return null;const m=url.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))([^&?\s]+)/);return m?m[1]:null;}
function render(list){const tb=document.getElementById('list');if(!list.length){tb.innerHTML='<tr><td colspan="8" class="empty-state">No videos found</td></tr>';return;}
tb.innerHTML=list.map(v=>{const dt=new Date(v.created_at).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});const ytId=getYTId(v.youtube_url);const thumb=v.thumbnail||(ytId?'https://img.youtube.com/vi/'+ytId+'/mqdefault.jpg':'');
return `<tr><td class="thumb-cell">${thumb?`<img src="${thumb}" alt="">`:''}</td>
<td><strong style="color:var(--navy)">${esc(v.title)}</strong><div class="row-actions"><button onclick="editItem(${v.id})">Edit</button><span style="color:var(--gray-300);padding:0 4px">|</span><button class="act-del" onclick="deleteItem(${v.id})">Trash</button></div></td>
<td>${esc(v.doctor_name||'‚Äî')}</td><td>${esc(v.hospital_name||'‚Äî')}</td><td>${esc(v.specialty_name||'‚Äî')}</td>
<td style="text-align:center">${v.is_featured?'<span style="color:#F59E0B;font-size:.9rem">‚òÖ</span>':'‚Äî'}</td>
<td><span class="badge badge--${v.status}">${v.status}</span></td><td style="font-size:.78rem;color:var(--gray-500)">${dt}</td></tr>`;}).join('');}
function autoSlug(){const t=document.getElementById('f_title').value;document.getElementById('f_slug').value=t.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');}
function autoThumb(){const url=document.getElementById('f_youtube_url').value;const ytId=getYTId(url);if(ytId){const thumb='https://img.youtube.com/vi/'+ytId+'/maxresdefault.jpg';document.getElementById('f_thumbnail').value=thumb;document.getElementById('thumbPreview').src=thumb;document.getElementById('thumbPreview').style.display='block';}else{document.getElementById('thumbPreview').style.display='none';}}
function openModal(){editId=null;document.getElementById('modalTitle').textContent='Add Video';document.getElementById('modal').classList.add('open');['f_title','f_slug','f_youtube_url','f_thumbnail','f_description'].forEach(f=>document.getElementById(f).value='');document.getElementById('f_sort_order').value='0';document.getElementById('f_status').value='draft';document.getElementById('f_featured').value='false';document.getElementById('f_doctor_id').value='';document.getElementById('f_hospital_id').value='';document.getElementById('f_specialty_id').value='';document.getElementById('f_treatment_id').value='';document.getElementById('thumbPreview').style.display='none';}
function editItem(id){const v=items.find(i=>i.id===id);if(!v)return;editId=id;document.getElementById('modalTitle').textContent='Edit Video';document.getElementById('modal').classList.add('open');document.getElementById('f_title').value=v.title||'';document.getElementById('f_slug').value=v.slug||'';document.getElementById('f_youtube_url').value=v.youtube_url||'';document.getElementById('f_thumbnail').value=v.thumbnail||'';document.getElementById('f_description').value=v.description||'';document.getElementById('f_sort_order').value=v.sort_order||0;document.getElementById('f_featured').value=v.is_featured?'true':'false';document.getElementById('f_status').value=v.status||'draft';document.getElementById('f_doctor_id').value=v.doctor_id||'';document.getElementById('f_hospital_id').value=v.hospital_id||'';document.getElementById('f_specialty_id').value=v.specialty_id||'';document.getElementById('f_treatment_id').value=v.treatment_id||'';const ytId=getYTId(v.youtube_url);if(ytId||v.thumbnail){document.getElementById('thumbPreview').src=v.thumbnail||'https://img.youtube.com/vi/'+ytId+'/mqdefault.jpg';document.getElementById('thumbPreview').style.display='block';}else{document.getElementById('thumbPreview').style.display='none';}}
function closeModal(){document.getElementById('modal').classList.remove('open');}
async function saveItem(){const data={title:document.getElementById('f_title').value,slug:document.getElementById('f_slug').value,youtube_url:document.getElementById('f_youtube_url').value,thumbnail:document.getElementById('f_thumbnail').value,description:document.getElementById('f_description').value,doctor_id:document.getElementById('f_doctor_id').value||null,hospital_id:document.getElementById('f_hospital_id').value||null,specialty_id:document.getElementById('f_specialty_id').value||null,treatment_id:document.getElementById('f_treatment_id').value||null,sort_order:+document.getElementById('f_sort_order').value||0,is_featured:document.getElementById('f_featured').value==='true',status:document.getElementById('f_status').value};if(!data.title||!data.youtube_url)return alert('Title and YouTube URL are required');if(!data.slug)data.slug=data.title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');try{const url=editId?API+'/'+editId:API;const r=await fetch(url,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load();}else{const e=await r.json();alert(e.error||'Save failed');}}catch(e){alert('Save failed');}}
async function deleteItem(id){if(!confirm('Delete this video permanently?'))return;try{await fetch(API+'/'+id,{method:'DELETE'});load();}catch(e){alert('Failed');}}
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeModal();});loadDropdowns();load();
</script>
</body></html>
