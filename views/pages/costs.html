<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Cost Manager | Ginger Admin</title><link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/admin.css"><script src="/js/sidebar.js" defer></script>
</head><body><div class="layout"><aside class="sidebar" id="sidebar"></aside>
<main class="main"><header class="topbar"><button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button><h1 class="topbar__title">ðŸ’° Treatment Cost Manager</h1><div class="topbar__actions"><button class="btn btn--primary" onclick="openModal()">+ Add Cost Entry</button></div></header><div class="content"><div class="card"><div class="card__body"><table class="data-table"><thead><tr><th>Treatment</th><th>Destination</th><th>Cost (USD)</th><th>Hospital Stay</th><th>Actions</th></tr></thead><tbody id="list"><tr><td colspan="5" class="loading">Loading...</td></tr></tbody></table></div></div></div>
<div class="modal-overlay" id="modal"><div class="modal"><div class="modal__header"><h3 id="modalTitle">Add Cost Entry</h3><button class="modal__close" onclick="closeModal()">âœ•</button></div><div class="modal__body">
<div class="form-row"><div class="form-group"><label class="form-label">Treatment</label><select class="form-select" id="f_treatment"></select></div><div class="form-group"><label class="form-label">Destination</label><select class="form-select" id="f_destination"></select></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Min Cost (USD)</label><input type="number" class="form-input" id="f_min"></div><div class="form-group"><label class="form-label">Max Cost (USD)</label><input type="number" class="form-input" id="f_max"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Hospital Stay</label><input type="text" class="form-input" id="f_stay" placeholder="3-5 days"></div><div class="form-group"><label class="form-label">Includes</label><input type="text" class="form-input" id="f_includes" placeholder="Surgery, meds, stay"></div></div>
</div><div class="modal__footer"><button class="btn btn--outline" onclick="closeModal()">Cancel</button><button class="btn btn--primary" onclick="saveItem()">Save</button></div></div></div></main></div>
<script>let items=[],editId=null;
async function load(){const[r1,r2,r3]=await Promise.all([fetch('/api/costs'),fetch('/api/treatments'),fetch('/api/destinations')]);items=await r1.json();const trts=await r2.json();const dests=await r3.json();
document.getElementById('f_treatment').innerHTML=trts.map(t=>'<option value="'+t.id+'">'+t.name+'</option>').join('');
document.getElementById('f_destination').innerHTML=dests.map(d=>'<option value="'+d.id+'">'+d.flag+' '+d.name+'</option>').join('');render()}
function render(){const tb=document.getElementById('list');if(!items.length){tb.innerHTML='<tr><td colspan="5" class="empty-state">No cost entries yet. Add treatment costs per destination.</td></tr>';return}
tb.innerHTML=items.map(c=>`<tr><td><strong>${c.treatment_name||'-'}</strong></td><td>${c.destination_flag||''} ${c.destination_name||'-'}</td><td>$${c.cost_min_usd||0} - $${c.cost_max_usd||0}</td><td>${c.hospital_stay||'-'}</td><td><button class="btn btn--outline btn--sm" onclick="editItem(${c.id})">Edit</button> <button class="btn btn--danger btn--sm" onclick="deleteItem(${c.id})">ðŸ—‘</button></td></tr>`).join('')}
function openModal(){editId=null;document.getElementById('modal').classList.add('open');['f_min','f_max','f_stay','f_includes'].forEach(f=>document.getElementById(f).value='')}
function closeModal(){document.getElementById('modal').classList.remove('open')}
function editItem(id){const c=items.find(i=>i.id===id);if(!c)return;editId=id;document.getElementById('modal').classList.add('open');document.getElementById('f_treatment').value=c.treatment_id;document.getElementById('f_destination').value=c.destination_id;document.getElementById('f_min').value=c.cost_min_usd||'';document.getElementById('f_max').value=c.cost_max_usd||'';document.getElementById('f_stay').value=c.hospital_stay||'';document.getElementById('f_includes').value=c.includes||''}
async function saveItem(){const data={treatment_id:parseInt(document.getElementById('f_treatment').value),destination_id:parseInt(document.getElementById('f_destination').value),cost_min_usd:parseInt(document.getElementById('f_min').value)||0,cost_max_usd:parseInt(document.getElementById('f_max').value)||0,hospital_stay:document.getElementById('f_stay').value,includes:document.getElementById('f_includes').value};
const url=editId?'/api/costs/'+editId:'/api/costs';const method=editId?'PUT':'POST';const r=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load()}else{alert('Error')}}
async function deleteItem(id){if(!confirm('Delete?'))return;await fetch('/api/costs/'+id,{method:'DELETE'});load()}
</script>
</body></html>
