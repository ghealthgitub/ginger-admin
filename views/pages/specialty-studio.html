<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Specialty Studio | Ginger Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>
:root{--navy:#0B2545;--navy-light:#13315C;--ginger:#F26522;--ginger-dark:#D9531E;--teal:#0EA5A0;--white:#FFFFFF;--gray-50:#F9FAFB;--gray-100:#F3F4F6;--gray-200:#E5E7EB;--gray-300:#D1D5DB;--gray-400:#9CA3AF;--gray-500:#6B7280;--gray-600:#4B5563;--gray-700:#374151}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--gray-100);height:100vh;overflow:hidden;font-size:14px;color:var(--gray-700)}
.topbar{display:flex;align-items:center;gap:12px;padding:0 16px;background:var(--white);border-bottom:1px solid var(--gray-200);z-index:10;height:48px}
.topbar__back{color:#fff;font-size:.82rem;text-decoration:none;padding:6px 12px;border:none;border-radius:6px;font-weight:600;display:flex;align-items:center;gap:4px;background:var(--teal)}.topbar__back:hover{background:#0c918c}
.topbar__title{flex:1;color:var(--navy);font-family:'Playfair Display',serif;font-size:1rem;font-weight:600;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.topbar__status{font-size:.7rem;font-weight:700;padding:3px 10px;border-radius:50px;text-transform:uppercase}
.topbar__status--draft{background:#FEF3C7;color:#D97706;border:1px solid #FCD34D}
.topbar__status--published{background:#D1FAE5;color:#059669;border:1px solid #6EE7B7}
.topbar__saved{color:var(--teal);font-size:.78rem;font-weight:600;display:none}
.topbar__actions{display:flex;gap:6px}
.topbar__btn{padding:6px 14px;border-radius:6px;font-weight:600;font-size:.8rem;cursor:pointer;border:none;font-family:inherit;transition:all .2s}
.topbar__btn--save{background:var(--gray-50);color:var(--gray-600);border:1px solid var(--gray-200)}.topbar__btn--save:hover{background:var(--gray-200)}
.topbar__btn--publish{background:var(--teal);color:#fff}.topbar__btn--publish:hover{background:#0c918c}
.studio{display:flex;height:calc(100vh - 48px)}
.panel-left{width:300px;min-width:220px;background:var(--white);border-right:1px solid var(--gray-200);display:flex;flex-direction:column;flex-shrink:0;overflow:hidden}
.ai-header{padding:12px 16px;border-bottom:1px solid var(--gray-200);flex-shrink:0}
.ai-header__title{color:var(--navy);font-size:.88rem;font-weight:700;display:flex;align-items:center;gap:6px}
.ai-header__sub{color:var(--gray-400);font-size:.72rem;margin-top:2px}
.tone-row{display:flex;gap:4px;padding:8px 12px;border-bottom:1px solid var(--gray-100);flex-shrink:0;flex-wrap:wrap}
.tone-btn{padding:3px 10px;border-radius:50px;font-size:.72rem;font-weight:600;cursor:pointer;border:1px solid var(--gray-200);background:var(--white);color:var(--gray-400);font-family:inherit;transition:all .2s}
.tone-btn:hover{color:var(--navy);border-color:var(--gray-300)}
.tone-btn.active{background:rgba(14,165,160,.08);color:var(--teal);border-color:var(--teal)}
.ai-messages{flex:1;overflow-y:auto;padding:12px 14px;display:flex;flex-direction:column;gap:8px;min-height:0;background:var(--gray-50)}
.ai-messages::-webkit-scrollbar{width:3px}.ai-messages::-webkit-scrollbar-thumb{background:var(--gray-300);border-radius:3px}
.ai-msg{padding:10px 12px;border-radius:10px;font-size:.82rem;line-height:1.6;max-width:95%;animation:fadeMsg .3s}
@keyframes fadeMsg{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}
.ai-msg--user{background:var(--teal);color:#fff;align-self:flex-end;border-bottom-right-radius:3px}
.ai-msg--bot{background:var(--white);color:var(--gray-700);align-self:flex-start;border:1px solid var(--gray-200);border-bottom-left-radius:3px}
.ai-msg--bot strong{color:var(--teal)}
.ai-msg--system{background:rgba(14,165,160,.08);color:var(--teal);align-self:center;font-size:.75rem;font-weight:600;border-radius:20px;padding:4px 14px}
.ai-msg__actions{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap}
.ai-msg__btn{padding:4px 10px;border-radius:5px;font-size:.73rem;font-weight:600;cursor:pointer;border:none;font-family:inherit;transition:all .2s}
.ai-msg__btn--insert{background:var(--teal);color:#fff}.ai-msg__btn--insert:hover{background:#0c918c}
.ai-msg__btn--append{background:var(--gray-100);color:var(--gray-600);border:1px solid var(--gray-200)}.ai-msg__btn--append:hover{background:var(--gray-200)}
.ai-quick{display:flex;flex-wrap:wrap;gap:4px;padding:8px 12px;border-top:1px solid var(--gray-100);flex-shrink:0;background:var(--white)}
.ai-qbtn{background:var(--gray-50);border:1px solid var(--gray-200);color:var(--gray-500);border-radius:6px;padding:4px 10px;font-size:.72rem;cursor:pointer;font-family:inherit;transition:all .2s}
.ai-qbtn:hover{background:var(--teal);color:#fff;border-color:var(--teal)}
.ai-input{padding:10px 12px;border-top:1px solid var(--gray-200);background:var(--white);flex-shrink:0}
.ai-input__row{display:flex;gap:6px;align-items:flex-end}
.ai-input textarea{flex:1;background:var(--gray-50);border:1px solid var(--gray-200);border-radius:8px;padding:8px 10px;color:var(--navy);font-size:.82rem;font-family:inherit;resize:none;min-height:80px;max-height:200px;line-height:1.5}
.ai-input textarea::placeholder{color:var(--gray-400)}.ai-input textarea:focus{outline:none;border-color:var(--teal)}
.ai-send{width:32px;height:32px;background:var(--teal);color:#fff;border:none;border-radius:50%;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;flex-shrink:0}.ai-send:hover{background:#0c918c}.ai-send:disabled{opacity:.4}
.ai-attach{width:32px;height:28px;background:var(--gray-100);border:1px solid var(--gray-200);border-radius:50%;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;flex-shrink:0}.ai-attach:hover{background:var(--gray-200)}
.ai-input__attachments{padding:6px 0 0;display:flex;gap:6px}
.ai-input__file{display:flex;align-items:center;gap:6px;background:rgba(14,165,160,.08);border:1px solid rgba(14,165,160,.2);border-radius:6px;padding:4px 8px;font-size:.72rem;color:var(--teal);font-weight:600}
.ai-input__file button{background:none;border:none;cursor:pointer;color:var(--gray-400);font-size:.85rem;padding:0 2px}.ai-input__file button:hover{color:#EF4444}
.ai-input__tools{display:flex;gap:6px;padding-top:8px}
.ai-tool-btn{display:flex;align-items:center;gap:3px;padding:4px 10px;background:var(--gray-50);border:1px solid var(--gray-200);border-radius:6px;font-size:.72rem;font-weight:600;color:var(--gray-500);cursor:pointer;font-family:inherit;transition:all .2s}
.ai-tool-btn:hover{background:var(--teal);color:#fff;border-color:var(--teal)}
.ai-typing{display:flex;gap:4px;padding:6px 10px}.ai-typing span{width:5px;height:5px;border-radius:50%;background:var(--gray-400);animation:blink 1.4s infinite}.ai-typing span:nth-child(2){animation-delay:.2s}.ai-typing span:nth-child(3){animation-delay:.4s}
@keyframes blink{0%,80%,100%{opacity:.3}40%{opacity:1}}
.drag-handle{width:5px;background:var(--gray-200);cursor:col-resize;flex-shrink:0;position:relative;transition:background .2s}
.drag-handle:hover,.drag-handle.dragging{background:var(--teal)}
.drag-handle::after{content:'‚ãÆ';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:var(--gray-400);font-size:12px}.drag-handle:hover::after{color:#fff}
.panel-middle{flex:1;display:flex;flex-direction:column;min-width:300px;background:var(--white);overflow:hidden}
.title-area{padding:20px 32px 0;flex-shrink:0}
.title-input{width:100%;border:none;outline:none;font-family:'Playfair Display',serif;font-size:1.65rem;font-weight:600;color:var(--navy);padding:0;margin-bottom:6px;line-height:1.3}.title-input::placeholder{color:var(--gray-300)}
.permalink-area{display:flex;align-items:center;gap:6px;font-size:.78rem;color:var(--gray-400);margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--gray-100)}
.permalink-area input{border:none;outline:none;font-size:.78rem;color:var(--teal);font-weight:500;padding:2px 4px;border-radius:3px;background:transparent;flex:1;min-width:0;font-family:inherit}
.permalink-area input:focus{background:var(--gray-50);border:1px solid var(--gray-200)}
.permalink-edit{font-size:.72rem;color:var(--teal);cursor:pointer;font-weight:600;border:none;background:none;font-family:inherit}.permalink-edit:hover{text-decoration:underline}
.spec-fields{display:flex;gap:12px;padding:0 32px 12px;flex-shrink:0;border-bottom:1px solid var(--gray-100);align-items:flex-end}
.spec-field{display:flex;flex-direction:column;gap:2px}
.spec-field label{font-size:.7rem;font-weight:600;color:var(--gray-400);text-transform:uppercase}
.spec-field input,.spec-field select{border:1px solid var(--gray-200);border-radius:6px;padding:5px 10px;font-size:.85rem;font-family:inherit}
.spec-field input:focus,.spec-field select:focus{outline:none;border-color:var(--teal)}
.editor-toolbar-area{display:flex;align-items:center;justify-content:space-between;padding:4px 12px;border-bottom:1px solid var(--gray-200);background:var(--white);flex-shrink:0}
.editor-tabs{display:flex;gap:0}
.editor-tab{padding:6px 14px;font-size:.8rem;font-weight:600;color:var(--gray-400);cursor:pointer;border-radius:6px;transition:all .2s;display:flex;align-items:center;gap:4px}
.editor-tab.active{color:var(--teal);background:rgba(14,165,160,.08)}.editor-tab:hover:not(.active){color:var(--gray-600)}
.editor-stats{display:flex;gap:12px;font-size:.75rem;color:var(--gray-400)}
.editor-wrap{flex:1;display:flex;flex-direction:column;overflow:hidden}
.editor-wrap .ql-toolbar{border:none!important;border-bottom:1px solid var(--gray-200)!important;background:var(--white);padding:6px 12px!important}
.editor-wrap .ql-container{border:none!important;flex:1;overflow-y:auto}
.editor-wrap .ql-editor{min-height:100%;padding:20px 32px;font-size:.95rem;line-height:1.85;font-family:'DM Sans',sans-serif;color:var(--gray-700)}
.editor-wrap .ql-editor h1,.editor-wrap .ql-editor h2,.editor-wrap .ql-editor h3{font-family:'Playfair Display',serif;color:var(--navy);margin:14px 0 8px}
.editor-wrap .ql-editor p{margin-bottom:12px}
.preview-pane{flex:1;overflow-y:auto;display:none;padding:20px 32px;font-size:.95rem;line-height:1.85;font-family:'DM Sans',sans-serif}
.preview-pane.active{display:block}
.preview-pane h1,.preview-pane h2,.preview-pane h3{font-family:'Playfair Display',serif;color:var(--navy)}
.panel-right{width:320px;min-width:260px;background:var(--white);border-left:1px solid var(--gray-200);overflow-y:auto;flex-shrink:0}
.panel-right::-webkit-scrollbar{width:3px}.panel-right::-webkit-scrollbar-thumb{background:var(--gray-300);border-radius:3px}
.sb-box{border:1px solid var(--gray-200);border-radius:8px;margin:12px 12px 0;overflow:hidden}.sb-box:last-child{margin-bottom:12px}
.sb-box__head{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;background:var(--gray-50);border-bottom:1px solid var(--gray-200);cursor:pointer;user-select:none}
.sb-box__title{font-size:.82rem;font-weight:700;color:var(--navy);display:flex;align-items:center;gap:6px}
.sb-box__toggle{font-size:.7rem;color:var(--gray-400);transition:transform .2s}
.sb-box.collapsed .sb-box__body{display:none}.sb-box.collapsed .sb-box__toggle{transform:rotate(-90deg)}
.sb-box__body{padding:14px}
.sb-label{font-size:.75rem;font-weight:600;color:var(--gray-500);margin-bottom:4px;display:flex;align-items:center;justify-content:space-between}
.sb-label .char-count{font-weight:400;color:var(--gray-400)}
.sb-input{width:100%;padding:7px 10px;border:1px solid var(--gray-200);border-radius:6px;font-family:inherit;font-size:.82rem;transition:border .2s;margin-bottom:10px}.sb-input:focus{outline:none;border-color:var(--teal)}
.sb-textarea{width:100%;padding:7px 10px;border:1px solid var(--gray-200);border-radius:6px;font-family:inherit;font-size:.82rem;resize:vertical;min-height:55px;line-height:1.5;margin-bottom:10px}.sb-textarea:focus{outline:none;border-color:var(--teal)}
.sb-select{width:100%;padding:7px 10px;border:1px solid var(--gray-200);border-radius:6px;font-family:inherit;font-size:.82rem;background:var(--white);margin-bottom:10px}
.sb-hint{font-size:.72rem;color:var(--gray-400);margin:-6px 0 10px}
.publish-box{border-color:var(--teal)}.publish-box .sb-box__head{background:rgba(14,165,160,.04);border-bottom-color:rgba(14,165,160,.15)}
.publish-row{display:flex;align-items:center;gap:8px;font-size:.8rem;color:var(--gray-600);margin-bottom:8px}
.publish-row span:first-child{color:var(--gray-400);width:14px;text-align:center}
.publish-btns{display:flex;gap:6px;margin-top:12px;padding-top:12px;border-top:1px solid var(--gray-100)}
.publish-btns .btn-publish{flex:1;padding:8px;background:var(--teal);color:#fff;border:none;border-radius:6px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:inherit}.publish-btns .btn-publish:hover{background:#0c918c}
.publish-btns .btn-save{padding:8px 14px;background:var(--white);color:var(--gray-600);border:1px solid var(--gray-200);border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;font-family:inherit}.publish-btns .btn-save:hover{background:var(--gray-100)}
.seo-badge{display:inline-flex;padding:3px 10px;border-radius:4px;font-size:.78rem;font-weight:700}
.seo-badge--green{background:#D1FAE5;color:#059669}.seo-badge--yellow{background:#FEF3C7;color:#D97706}.seo-badge--red{background:#FEE2E2;color:#DC2626}.seo-badge--gray{background:var(--gray-100);color:var(--gray-400)}
.feat-img-preview{width:100%;border-radius:6px;object-fit:cover;border:1px solid var(--gray-200);margin-bottom:8px;display:none;max-height:160px;background:var(--gray-50)}
.feat-img-empty{border:2px dashed var(--gray-200);border-radius:8px;padding:24px;text-align:center;color:var(--gray-400);font-size:.8rem;cursor:pointer;transition:all .2s}.feat-img-empty:hover{border-color:var(--teal);background:rgba(14,165,160,.03)}
.feat-img-btns{display:flex;gap:6px;margin-top:6px}
.feat-img-btn{padding:4px 10px;border-radius:5px;font-size:.75rem;font-weight:600;cursor:pointer;border:1px solid var(--gray-200);background:var(--white);color:var(--gray-600);font-family:inherit}.feat-img-btn:hover{border-color:var(--teal);color:var(--teal)}
.analysis-item{display:flex;align-items:center;gap:6px;font-size:.78rem;color:var(--gray-500);margin-bottom:4px}
.mp-overlay{position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:9999;display:none;align-items:center;justify-content:center;padding:20px}.mp-overlay.active{display:flex}
.mp-modal{background:#fff;border-radius:14px;width:100%;max-width:760px;max-height:80vh;display:flex;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.3);overflow:hidden}
.mp-head{display:flex;align-items:center;justify-content:space-between;padding:14px 20px;border-bottom:1px solid var(--gray-200)}
.mp-head h3{font-family:'Playfair Display',serif;font-size:1rem;color:var(--navy);margin:0}
.mp-close{background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--gray-400)}.mp-close:hover{color:var(--navy)}
.mp-body{flex:1;overflow-y:auto;padding:16px 20px}
.mp-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(100px,1fr));gap:8px}
.mp-item{border:2px solid transparent;border-radius:8px;overflow:hidden;cursor:pointer;aspect-ratio:1;background:var(--gray-100)}.mp-item:hover{border-color:var(--teal)}
.mp-item.selected{border-color:var(--teal);box-shadow:0 0 0 2px rgba(14,165,160,.3)}
.mp-item img{width:100%;height:100%;object-fit:cover}
.mp-foot{display:flex;align-items:center;justify-content:space-between;padding:12px 20px;border-top:1px solid var(--gray-200);gap:8px}
.mp-foot .set-btn{padding:6px 14px;background:var(--teal);color:#fff;border:none;border-radius:6px;font-size:.82rem;font-weight:700;cursor:pointer;font-family:inherit}.mp-foot .set-btn:hover{background:#0c918c}.mp-foot .set-btn:disabled{opacity:.4}
.autosave-toast{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--navy);color:#fff;padding:8px 20px;border-radius:8px;font-size:.8rem;font-weight:600;display:none;z-index:100;box-shadow:0 4px 15px rgba(0,0,0,.2)}
</style></head>
<body>
<div class="topbar">
    <a href="/specialties-mgmt" class="topbar__back">‚Üê Back</a>
    <div class="topbar__title" id="topTitle">New Specialty</div>
    <span class="topbar__status topbar__status--draft" id="topStatus">DRAFT</span>
    <span class="topbar__saved" id="topSaved">‚úì Saved</span>
    <div class="topbar__actions">
        <button class="topbar__btn topbar__btn--save" onclick="saveSpec('draft')">Save Draft</button>
        <button class="topbar__btn topbar__btn--publish" onclick="saveSpec('published')">üöÄ Publish</button>
    </div>
</div>
<div class="studio">
<!-- LEFT: AI -->
<div class="panel-left" id="panelLeft">
    <div class="ai-header"><div class="ai-header__title">ü§ñ AI Writing Assistant</div><div class="ai-header__sub">Write, edit, optimize ‚Äî powered by Claude</div></div>
    <div class="tone-row">
        <button class="tone-btn active" data-tone="professional" onclick="setTone(this)">Professional</button>
        <button class="tone-btn" data-tone="friendly" onclick="setTone(this)">Friendly</button>
        <button class="tone-btn" data-tone="medical" onclick="setTone(this)">Medical</button>
        <button class="tone-btn" data-tone="patient" onclick="setTone(this)">Patient-friendly</button>
        <button class="tone-btn" data-tone="seo" onclick="setTone(this)">SEO-focused</button>
    </div>
    <div class="ai-messages" id="aiMessages">
        <div class="ai-msg ai-msg--system">‚ú® AI Ready</div>
        <div class="ai-msg ai-msg--bot">Hi! I'll help you write and optimize content for this specialty. What would you like to do?</div>
    </div>
    <div class="ai-quick">
        <button class="ai-qbtn" onclick="aiCmd('Write a comprehensive description covering overview, common conditions, procedures, and why patients choose this specialty abroad. Use H2/H3 headings. 600-800 words.')">‚ú® Write full post</button>
        <button class="ai-qbtn" onclick="aiCmd('Generate meta title, meta description, and short description based on the content')">üè∑ Auto SEO</button>
        <button class="ai-qbtn" onclick="aiCmd('Improve the current content - make it more detailed and engaging')">üéØ Improve</button>
        <button class="ai-qbtn" onclick="aiCmd('Fix grammar and improve readability')">‚úè Fix grammar</button>
        <button class="ai-qbtn" onclick="aiCmd('Write a compelling introduction paragraph')">üìù Add intro</button>
        <button class="ai-qbtn" onclick="aiCmd('Add a conclusion with call-to-action for patients')">üé¨ Conclusion</button>
        <button class="ai-qbtn" onclick="aiCmd('List 10 common conditions treated with brief descriptions as HTML ul/li')">üè• Conditions</button>
        <button class="ai-qbtn" onclick="aiCmd('Make the content shorter and more concise')">‚úÇ Shorten</button>
    </div>
    <div class="ai-input">
        <div class="ai-input__row">
            <textarea id="aiInput" placeholder="Ask AI to write, edit, improve..." onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();aiCmd()}"></textarea>
            <div style="display:flex;flex-direction:column;gap:4px">
                <button class="ai-send" onclick="aiCmd()" id="aiSendBtn" title="Send">‚ñ∂</button>
                <label class="ai-attach" title="Attach image or document"><input type="file" id="aiFileInput" style="display:none" accept="image/*,.docx,.doc,.txt,.md,.pdf" onchange="handleFileAttach(this)">üìé</label>
            </div>
        </div>
        <div class="ai-input__attachments" id="aiAttachments" style="display:none">
            <div class="ai-input__file" id="aiAttachedFile">
                <span id="aiFileName"></span>
                <button onclick="removeAiAttachment()">√ó</button>
            </div>
        </div>
        <div class="ai-input__tools">
            <label class="ai-tool-btn" title="Import Word document into editor"><input type="file" style="display:none" accept=".docx,.doc,.txt,image/*" onchange="importFile(this)">üìÑ Import files & images</label>
        </div>
    </div>
</div>
<div class="drag-handle" id="dragLeft"></div>
<!-- MIDDLE: Editor -->
<div class="panel-middle" id="panelMiddle">
    <div class="title-area">
        <input type="text" class="title-input" id="name" placeholder="Specialty name..." oninput="autoSlug();updateTopTitle()">
        <div class="permalink-area"><span>Permalink:</span><span style="color:var(--gray-500)">ginger.healthcare/specialties/</span><input type="text" id="slug" placeholder="specialty-slug" oninput="slugEdited=true"><button class="permalink-edit" onclick="document.getElementById('slug').focus()">Edit</button></div>
    </div>
    <div class="spec-fields">
        <div class="spec-field"><label>Icon</label><input type="text" id="icon" placeholder="ü´Ä" style="width:50px;text-align:center;font-size:1.2rem"></div>
        <div class="spec-field"><label>Category</label><select id="category"><option value="">None</option><option value="surgical">Surgical</option><option value="medical">Medical</option><option value="oncology">Oncology</option><option value="super_specialty">Super Specialty</option></select></div>
        <div class="spec-field" style="flex:1"><label>Short Description</label><input type="text" id="description" placeholder="Brief overview for listings..." style="width:100%"></div>
    </div>
    <div class="editor-toolbar-area">
        <div class="editor-tabs"><div class="editor-tab active" id="tabWrite" onclick="showTab('write')">‚úè Write</div><div class="editor-tab" id="tabPreview" onclick="showTab('preview')">üëÅ Preview</div></div>
        <div class="editor-stats"><span id="wordCount">0 words</span></div>
    </div>
    <div class="editor-wrap" id="editorWrap"><div id="editor"></div></div>
    <div class="preview-pane" id="previewPane"></div>
</div>
<div class="drag-handle" id="dragRight"></div>
<!-- RIGHT: Settings -->
<div class="panel-right" id="panelRight">
    <div class="sb-box publish-box"><div class="sb-box__head" onclick="this.parentElement.classList.toggle('collapsed')"><div class="sb-box__title">üìã Publish</div><span class="sb-box__toggle">‚ñæ</span></div>
        <div class="sb-box__body">
            <div class="publish-row"><span>üìå</span><strong>Status:</strong><span id="pubStatus">Draft</span></div>
            <div class="publish-row"><span>‚≠ê</span><strong>Featured:</strong><span id="pubFeatured">No</span></div>
            <div class="publish-row"><span>üìä</span><strong>SEO:</strong><span class="seo-badge seo-badge--gray" id="seoBadge">0 / 100</span></div>
            <select class="sb-select" id="status" onchange="updatePublishUI()"><option value="draft">üìù Draft</option><option value="published">‚úÖ Published</option></select>
            <div style="display:flex;gap:10px;margin-bottom:6px"><div style="flex:1"><div class="sb-label">Featured</div><select class="sb-select" id="is_featured" style="margin-bottom:0"><option value="false">No</option><option value="true">Yes ‚≠ê</option></select></div><div style="flex:1"><div class="sb-label">Order</div><input class="sb-input" type="number" id="display_order" value="0" style="margin-bottom:0"></div></div>
            <div class="publish-btns"><button class="btn-save" onclick="saveSpec('draft')">Save Draft</button><button class="btn-publish" onclick="saveSpec('published')">üöÄ Publish</button></div>
        </div>
    </div>
    <div class="sb-box"><div class="sb-box__head" onclick="this.parentElement.classList.toggle('collapsed')"><div class="sb-box__title">üñº Featured Image</div><span class="sb-box__toggle">‚ñæ</span></div>
        <div class="sb-box__body">
            <div id="featImgBox" style="cursor:pointer" onclick="openMP()"><img class="feat-img-preview" id="featImgPreview"><div class="feat-img-empty" id="featImgEmpty"><div style="font-size:1.5rem;margin-bottom:4px">üñº</div>Click to set image</div></div>
            <div id="featImgActions" style="display:none;margin-top:6px"><div class="feat-img-btns"><button class="feat-img-btn" onclick="openMP()">Change</button><button class="feat-img-btn" onclick="removeImage()" style="color:#EF4444">Remove</button></div></div>
            <input type="hidden" id="image">
        </div>
    </div>
    <div class="sb-box"><div class="sb-box__head" onclick="this.parentElement.classList.toggle('collapsed')"><div class="sb-box__title">üîç SEO Settings</div><span class="sb-box__toggle">‚ñæ</span></div>
        <div class="sb-box__body">
            <div class="sb-label">Meta Title <span class="char-count" id="metaTitleCount">0/60</span></div>
            <input class="sb-input" id="meta_title" placeholder="SEO title (auto-generated)" oninput="updateCharCount('meta_title','metaTitleCount',60);analyzeSEO()">
            <div class="sb-label">Meta Description <span class="char-count" id="metaDescCount">0/160</span></div>
            <textarea class="sb-textarea" id="meta_description" placeholder="SEO description (auto-generated)" oninput="updateCharCount('meta_description','metaDescCount',160);analyzeSEO()"></textarea>
            <div class="sb-label">Treatment Count</div>
            <input class="sb-input" type="number" id="treatment_count" value="0">
        </div>
    </div>
    <div class="sb-box"><div class="sb-box__head" onclick="this.parentElement.classList.toggle('collapsed')"><div class="sb-box__title">üìä Content Analysis</div><span class="sb-box__toggle">‚ñæ</span></div>
        <div class="sb-box__body" id="contentAnalysis"><div class="analysis-item">Start writing to see analysis...</div></div>
    </div>
</div>
</div>
<!-- Media Picker -->
<div class="mp-overlay" id="mediaPicker" onclick="if(event.target===this)closeMP()">
<div class="mp-modal"><div class="mp-head"><h3>Select Image</h3><button class="mp-close" onclick="closeMP()">√ó</button></div>
<div class="mp-body"><div class="mp-grid" id="mpGrid"></div></div>
<div class="mp-foot"><label style="padding:6px 14px;border:1px solid var(--gray-200);border-radius:6px;font-size:.8rem;font-weight:600;cursor:pointer;color:var(--gray-600)">üì§ Upload<input type="file" accept="image/*" onchange="mpUpload(this)" style="display:none"></label><div id="mpStatus" style="flex:1;font-size:.78rem;color:var(--gray-400)"></div><button class="set-btn" id="mpSetBtn" disabled onclick="mpConfirm()">Set Image</button></div>
</div></div>
<div class="autosave-toast" id="autoToast"></div>

<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
const pathParts = window.location.pathname.split('/');
const editId = pathParts[2] === 'edit' ? pathParts[3] : null;
let currentTone = 'professional', autoSaveTimer = null, slugEdited = false, aiGenerating = false, mpSelectedUrl = null;

const quill = new Quill('#editor', {
    theme: 'snow', placeholder: 'Write detailed content about this specialty...',
    modules: { toolbar: [[{header:[1,2,3,false]}],['bold','italic','underline','strike'],[{color:[]},{background:[]}],[{list:'ordered'},{list:'bullet'}],['blockquote','code-block'],['link','image'],[{align:[]}],['clean']] }
});
quill.on('text-change', () => { updateStats(); analyzeSEO(); resetAutoSave(); });

function resetAutoSave() { clearTimeout(autoSaveTimer); autoSaveTimer = setTimeout(() => { if(editId) saveSpec('auto'); }, 15000); }
function updateTopTitle() { document.getElementById('topTitle').textContent = document.getElementById('name').value || 'New Specialty'; }
function autoSlug() { if(!slugEdited && !editId){ const n=document.getElementById('name').value; document.getElementById('slug').value=n.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,''); } }
function showTab(t) {
    document.getElementById('tabWrite').classList.toggle('active',t==='write');
    document.getElementById('tabPreview').classList.toggle('active',t==='preview');
    document.getElementById('editorWrap').style.display = t==='write'?'flex':'none';
    const pp = document.getElementById('previewPane');
    pp.style.display = t==='preview'?'block':'none';
    if(t==='preview') pp.innerHTML = quill.root.innerHTML;
}
function updateStats() {
    const text=quill.getText().trim(), words=text?text.split(/\s+/).length:0;
    document.getElementById('wordCount').textContent=words+' words';
    const a=[];
    if(words<300) a.push('<div class="analysis-item">‚ö†Ô∏è Content is short ('+words+' words, aim for 600+)</div>');
    else if(words>600) a.push('<div class="analysis-item">‚úÖ Good length ('+words+' words)</div>');
    else a.push('<div class="analysis-item">üìù '+words+' words (aim for 600+)</div>');
    const h2=(quill.root.innerHTML.match(/<h2/g)||[]).length;
    a.push(h2?'<div class="analysis-item">‚úÖ '+h2+' heading(s)</div>':'<div class="analysis-item">‚ö†Ô∏è No H2 headings</div>');
    const links=(quill.root.innerHTML.match(/<a /g)||[]).length;
    a.push(links?'<div class="analysis-item">‚úÖ '+links+' link(s)</div>':'<div class="analysis-item">‚ö†Ô∏è No links found</div>');
    document.getElementById('contentAnalysis').innerHTML=a.join('');
}
function analyzeSEO() {
    let s=0;const title=document.getElementById('name').value,mt=document.getElementById('meta_title').value,md=document.getElementById('meta_description').value,c=quill.getText(),w=c.split(/\s+/).length;
    if(title)s+=15;if(mt&&mt.length>=30&&mt.length<=60)s+=20;if(md&&md.length>=80&&md.length<=160)s+=20;if(w>=600)s+=15;if(w>=300)s+=10;
    if((quill.root.innerHTML.match(/<h2/g)||[]).length>0)s+=10;if(document.getElementById('description').value.length>20)s+=10;
    const b=document.getElementById('seoBadge');b.textContent=s+' / 100';
    b.className='seo-badge '+(s>=70?'seo-badge--green':s>=40?'seo-badge--yellow':s>0?'seo-badge--red':'seo-badge--gray');
}
function updateCharCount(id,cid,max){const l=document.getElementById(id).value.length,e=document.getElementById(cid);e.textContent=l+'/'+max;e.style.color=l>max?'#EF4444':l>max*.8?'#F59E0B':''}
function updatePublishUI(){const s=document.getElementById('status').value;document.getElementById('pubStatus').textContent=s==='published'?'Published':'Draft';document.getElementById('topStatus').className='topbar__status topbar__status--'+s;document.getElementById('topStatus').textContent=s.toUpperCase()}
function setTone(btn){document.querySelectorAll('.tone-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');currentTone=btn.dataset.tone}
function showToast(msg){const t=document.getElementById('autoToast');t.textContent=msg;t.style.display='block';setTimeout(()=>t.style.display='none',2000)}

// === SAVE / LOAD ===
async function saveSpec(status) {
    const isAuto = status === 'auto';
    if(isAuto) status = document.getElementById('status').value;
    const data = {
        name:document.getElementById('name').value, slug:document.getElementById('slug').value,
        icon:document.getElementById('icon').value, category:document.getElementById('category').value,
        description:document.getElementById('description').value,
        long_description: quill.root.innerHTML==='<p><br></p>'?'':quill.root.innerHTML,
        image:document.getElementById('image').value,
        is_featured:document.getElementById('is_featured').value==='true',
        display_order:parseInt(document.getElementById('display_order').value)||0,
        treatment_count:parseInt(document.getElementById('treatment_count').value)||0,
        meta_title:document.getElementById('meta_title').value,
        meta_description:document.getElementById('meta_description').value,
        status: status || document.getElementById('status').value
    };
    if(!data.name){if(!isAuto)alert('Name is required');return}
    if(!data.slug)data.slug=data.name.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-|-$/g,'');
    try{
        const url=editId?'/api/specialties/'+editId:'/api/specialties';
        const r=await fetch(url,{method:editId?'PUT':'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});
        if(r.ok){
            const result=await r.json();
            if(isAuto){showToast('‚úì Auto-saved');const sv=document.getElementById('topSaved');sv.style.display='inline';setTimeout(()=>sv.style.display='none',2000)}
            else if(!editId&&result.id){saving=true;window.location.href='/specialties/edit/'+result.id}
            else{saving=true;window.location.href='/specialties-mgmt'}
        }else{const e=await r.json();if(!isAuto)alert(e.error||'Save failed')}
    }catch(e){if(!isAuto)alert('Save failed')}
}

async function loadSpec() {
    if(!editId)return;
    try{
        const r=await fetch('/api/specialties/'+editId);if(!r.ok)return;
        const s=await r.json();
        document.getElementById('name').value=s.name||'';
        document.getElementById('slug').value=s.slug||'';slugEdited=true;
        document.getElementById('icon').value=s.icon||'';
        document.getElementById('category').value=s.category||'';
        document.getElementById('description').value=s.description||'';
        quill.root.innerHTML=s.long_description||'';
        document.getElementById('status').value=s.status||'draft';
        document.getElementById('is_featured').value=s.is_featured?'true':'false';
        document.getElementById('display_order').value=s.display_order||0;
        document.getElementById('treatment_count').value=s.treatment_count||0;
        document.getElementById('meta_title').value=s.meta_title||'';
        document.getElementById('meta_description').value=s.meta_description||'';
        document.getElementById('image').value=s.image||'';
        updateTopTitle();updatePublishUI();updateStats();analyzeSEO();
        document.getElementById('pubFeatured').textContent=s.is_featured?'Yes ‚≠ê':'No';
        if(s.image)setFeatImage(s.image);
        updateCharCount('meta_title','metaTitleCount',60);
        updateCharCount('meta_description','metaDescCount',160);
    }catch(e){console.error(e)}
}

// === AI CHAT ===
function addMsg(text,type){const d=document.createElement('div');d.className='ai-msg ai-msg--'+type;d.innerHTML=text;document.getElementById('aiMessages').appendChild(d);document.getElementById('aiMessages').scrollTop=99999;return d}

async function aiCmd(preset) {
    const input=document.getElementById('aiInput');
    let prompt=preset||input.value.trim();if(!prompt||aiGenerating)return;
    if(!preset)input.value='';
    addMsg(preset?prompt.substring(0,80)+'...':prompt,'user');
    aiGenerating=true;document.getElementById('aiSendBtn').disabled=true;
    const typing=document.createElement('div');typing.className='ai-msg ai-msg--bot';typing.innerHTML='<div class="ai-typing"><span></span><span></span><span></span></div>';
    document.getElementById('aiMessages').appendChild(typing);
    document.getElementById('aiMessages').scrollTop=99999;
    try{
        const specName=document.getElementById('name').value||'this specialty';
        const attachedText=aiAttachedContent?'\n\nATTACHED DOCUMENT CONTENT:\n'+aiAttachedContent.substring(0,5000):'';
        const context='Specialty: '+specName+'\nCategory: '+(document.getElementById('category').value||'general')+'\nTone: '+currentTone+'\nCurrent content length: '+quill.getText().trim().split(/\s+/).length+' words'+attachedText;
        const fullPrompt='Specialty name: "'+specName+'"\n\n'+prompt+'\n\nIMPORTANT: Return content as clean HTML (h2, h3, p, ul, li tags). Do NOT wrap in markdown code blocks.';
        const r=await fetch('/api/ai/generate',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:fullPrompt,type:'specialty',context})});
        if(!r.ok)throw new Error('AI request failed');
        const data=await r.json();let content=data.content||'No response';
        typing.remove();
        // Clean code blocks if present
        let html=content;const match=html.match(/```html?\n?([\s\S]*?)```/);if(match)html=match[1].trim();
        const hasHTML=html.includes('<h')||html.includes('<p>')||html.includes('<ul>');
        const msgDiv=addMsg(hasHTML?'<div style="max-height:200px;overflow-y:auto;font-size:.78rem;line-height:1.5;border:1px solid var(--gray-200);border-radius:6px;padding:8px;margin-bottom:6px;background:var(--gray-50)">'+html+'</div>':content.replace(/\n/g,'<br>'),'bot');
        // Action buttons
        const acts=document.createElement('div');acts.className='ai-msg__actions';
        if(hasHTML){
            const ib=document.createElement('button');ib.className='ai-msg__btn ai-msg__btn--insert';ib.textContent='Replace editor ‚Üó';ib.onclick=()=>{quill.root.innerHTML=html;ib.textContent='‚úÖ Replaced!';ib.disabled=true};acts.appendChild(ib);
            const ab=document.createElement('button');ab.className='ai-msg__btn ai-msg__btn--append';ab.textContent='Append ‚Üì';ab.onclick=()=>{quill.root.innerHTML=(quill.root.innerHTML==='<p><br></p>'?'':quill.root.innerHTML)+html;ab.textContent='‚úÖ Appended!';ab.disabled=true};acts.appendChild(ab);
        }
        if(content.toLowerCase().includes('meta title')||content.toLowerCase().includes('meta description')){
            const sb=document.createElement('button');sb.className='ai-msg__btn ai-msg__btn--insert';sb.textContent='üîç Apply SEO';sb.onclick=()=>{
                content.split('\n').forEach(line=>{
                    if(line.toLowerCase().includes('meta title')){const v=line.replace(/.*?[:]\s*/i,'').replace(/^["']|["']$/g,'').trim();if(v)document.getElementById('meta_title').value=v}
                    if(line.toLowerCase().includes('meta description')){const v=line.replace(/.*?[:]\s*/i,'').replace(/^["']|["']$/g,'').trim();if(v)document.getElementById('meta_description').value=v}
                    if(line.toLowerCase().includes('short description')){const v=line.replace(/.*?[:]\s*/i,'').replace(/^["']|["']$/g,'').trim();if(v&&v.length<250)document.getElementById('description').value=v}
                });analyzeSEO();sb.textContent='‚úÖ Applied!';sb.disabled=true};
            acts.appendChild(sb);
        }
        if(acts.children.length)msgDiv.appendChild(acts);
    }catch(e){typing.remove();addMsg('‚ùå Error: '+e.message,'bot')}
    aiGenerating=false;document.getElementById('aiSendBtn').disabled=false;
}

// === IMAGE ===
function setFeatImage(url){
    const src=url.startsWith('http')?url:'https://enter.ginger.healthcare'+url;
    const img=document.getElementById('featImgPreview');img.src=src;img.style.display='block';
    document.getElementById('featImgEmpty').style.display='none';
    document.getElementById('featImgActions').style.display='block';
}
function removeImage(){document.getElementById('image').value='';document.getElementById('featImgPreview').style.display='none';document.getElementById('featImgEmpty').style.display='block';document.getElementById('featImgActions').style.display='none'}
async function openMP(){
    mpSelectedUrl=null;document.getElementById('mpSetBtn').disabled=true;
    document.getElementById('mpGrid').innerHTML='<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--gray-400)">Loading...</div>';
    document.getElementById('mediaPicker').classList.add('active');
    try{const r=await fetch('/api/media');const m=await r.json();const imgs=m.filter(x=>x.mime_type&&x.mime_type.startsWith('image/'));
    if(!imgs.length){document.getElementById('mpGrid').innerHTML='<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--gray-400)">No images yet. Upload one below.</div>';return}
    document.getElementById('mpGrid').innerHTML=imgs.map((x,i)=>'<div class="mp-item" onclick="mpPick(this,'+i+')" data-url="'+encodeURIComponent(x.url)+'"><img src="'+x.url+'" loading="lazy"></div>').join('')}catch(e){document.getElementById('mpGrid').innerHTML='<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--gray-400)">Failed to load media</div>'}
}
function closeMP(){document.getElementById('mediaPicker').classList.remove('active')}
function mpPick(el,idx){document.querySelectorAll('.mp-item').forEach(i=>i.classList.remove('selected'));el.classList.add('selected');mpSelectedUrl=decodeURIComponent(el.dataset.url);document.getElementById('mpSetBtn').disabled=false}
function mpConfirm(){if(!mpSelectedUrl)return;document.getElementById('image').value=mpSelectedUrl;setFeatImage(mpSelectedUrl);closeMP()}
async function mpUpload(input){const file=input.files[0];if(!file)return;const s=document.getElementById('mpStatus');s.textContent='‚è≥ Uploading...';
    try{const fd=new FormData();fd.append('file',file);const r=await fetch('/api/media/upload',{method:'POST',body:fd});if(r.ok){s.textContent='‚úÖ Done!';input.value='';setTimeout(()=>{s.textContent='';openMP()},500)}else{s.textContent='‚ùå Failed'}}catch(e){s.textContent='‚ùå '+e.message}}

// === FILE ATTACH (AI context) ===
let aiAttachedContent = null;
function handleFileAttach(input) {
    const file = input.files[0]; if(!file) return; input.value='';
    if(file.type.startsWith('image/')){
        uploadImageToServer(file).then(url=>{if(url){const idx=quill.getSelection(true)?.index||quill.getLength();quill.insertEmbed(idx,'image',url);quill.insertText(idx+1,'\n');showToast('‚úÖ Image inserted')}});return}
    if(file.name.endsWith('.txt')||file.name.endsWith('.md')){
        const reader=new FileReader();reader.onload=e=>{aiAttachedContent=e.target.result;showAiAttachment(file.name)};reader.readAsText(file);return}
    if(file.name.endsWith('.docx')||file.name.endsWith('.doc')){
        const fd=new FormData();fd.append('file',file);
        fetch('/api/import/docx-text',{method:'POST',body:fd}).then(r=>r.json()).then(data=>{aiAttachedContent=data.text||'';showAiAttachment(file.name)}).catch(()=>alert('Could not read file'));return}
    alert('Supported: images, .docx, .txt, .md');
}
function showAiAttachment(name){document.getElementById('aiFileName').textContent='üìé '+name;document.getElementById('aiAttachments').style.display='flex'}
function removeAiAttachment(){aiAttachedContent=null;document.getElementById('aiAttachments').style.display='none'}

// === IMPORT FILES INTO EDITOR ===
async function importFile(input) {
    const file=input.files[0]; if(!file) return; input.value='';
    if(file.type.startsWith('image/')){
        showToast('üì§ Uploading image...');
        const url=await uploadImageToServer(file);
        if(url){const idx=quill.getSelection(true)?.index||quill.getLength();quill.insertEmbed(idx,'image',url);quill.insertText(idx+1,'\n');showToast('‚úÖ Image inserted')}
        else showToast('‚ùå Upload failed');return}
    if(file.name.endsWith('.docx')||file.name.endsWith('.doc')){
        showToast('üìÑ Importing document...');
        const fd=new FormData();fd.append('file',file);
        try{const r=await fetch('/api/import/docx',{method:'POST',body:fd});if(r.ok){const data=await r.json();if(data.html){quill.root.innerHTML=data.html;updateStats();analyzeSEO()}showToast('‚úÖ Imported! '+(data.imageCount||0)+' image(s)')}else showToast('‚ùå Import failed')}catch(e){showToast('‚ùå Import failed')}return}
    if(file.name.endsWith('.txt')||file.name.endsWith('.md')){
        const reader=new FileReader();reader.onload=e=>{quill.root.innerHTML+=e.target.result.replace(/\n/g,'<br>');updateStats();analyzeSEO();showToast('‚úÖ Text imported')};reader.readAsText(file);return}
    alert('Supported: .docx, .txt, images');
}

async function uploadImageToServer(file) {
    const fd=new FormData();fd.append('file',file);
    try{const r=await fetch('/api/media/upload',{method:'POST',body:fd});if(r.ok){const data=await r.json();return data.url}}catch(e){}return null}

// === DRAG HANDLES ===
function initDrag(handleId,panelId,isLeft){
    const handle=document.getElementById(handleId),panel=document.getElementById(panelId);
    let startX,startW;
    handle.addEventListener('mousedown',e=>{e.preventDefault();startX=e.clientX;startW=panel.offsetWidth;handle.classList.add('dragging');
        const move=e2=>{const dx=e2.clientX-startX;panel.style.width=Math.max(200,Math.min(500,startW+(isLeft?dx:-dx)))+'px'};
        const up=()=>{handle.classList.remove('dragging');document.removeEventListener('mousemove',move);document.removeEventListener('mouseup',up)};
        document.addEventListener('mousemove',move);document.addEventListener('mouseup',up);
    });
}
initDrag('dragLeft','panelLeft',true);
initDrag('dragRight','panelRight',false);

// === KEYBOARD ===
let saving=false;
window.addEventListener('beforeunload',e=>{if(!saving&&document.getElementById('name').value){e.preventDefault();e.returnValue=''}});
document.addEventListener('keydown',e=>{if((e.ctrlKey||e.metaKey)&&e.key==='s'){e.preventDefault();saveSpec(editId?'auto':null)}});

// === INIT ===
if(editId)loadSpec();
</script>
</body></html>
