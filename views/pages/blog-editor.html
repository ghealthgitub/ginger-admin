<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Blog Editor | Ginger Admin</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/admin.css">
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>
.editor-layout{display:grid;grid-template-columns:1fr 320px;gap:20px}
.ql-editor{min-height:350px;font-size:.95rem;line-height:1.8;font-family:'DM Sans',sans-serif}
.ql-toolbar{border-radius:8px 8px 0 0;border-color:var(--gray-200)!important;background:var(--gray-50)}
.ql-container{border-radius:0 0 8px 8px;border-color:var(--gray-200)!important}
.ql-editor h1,.ql-editor h2,.ql-editor h3{font-family:'Playfair Display',serif;color:var(--navy)}
.ai-panel{background:var(--white);border:1px solid var(--gray-200);border-radius:12px;position:sticky;top:80px}
.ai-panel__header{padding:14px 18px;border-bottom:1px solid var(--gray-200);font-weight:700;font-size:.9rem;color:var(--navy)}
.ai-panel__body{padding:16px}
.ai-output{background:var(--gray-50);border:1px solid var(--gray-200);border-radius:8px;padding:14px;margin-top:12px;font-size:.85rem;line-height:1.6;max-height:300px;overflow-y:auto;display:none}
.ai-btn{width:100%;margin-bottom:8px}
.word-count{font-size:.78rem;color:var(--gray-400);margin-top:6px;text-align:right}
@media(max-width:1024px){.editor-layout{grid-template-columns:1fr}}
</style></head>
<body><div class="layout"><aside class="sidebar" id="sidebar"><div class="sidebar__logo"><div class="sidebar__logo-icon">G</div><div class="sidebar__logo-text"><span>Ginger</span> <span>Admin</span></div></div><nav class="sidebar__nav"><a href="/" class="sidebar__link"><span class="sidebar__link-icon">ğŸ“Š</span> Dashboard</a><div class="sidebar__section">Content</div><a href="/blog" class="sidebar__link sidebar__link--active"><span class="sidebar__link-icon">ğŸ“</span> Blog Posts</a><a href="/specialties-mgmt" class="sidebar__link"><span class="sidebar__link-icon">ğŸ·ï¸</span> Specialties</a><a href="/treatments" class="sidebar__link"><span class="sidebar__link-icon">ğŸ’Š</span> Treatments</a><a href="/destinations-mgmt" class="sidebar__link"><span class="sidebar__link-icon">ğŸŒ</span> Destinations</a><a href="/hospitals" class="sidebar__link"><span class="sidebar__link-icon">ğŸ¥</span> Hospitals</a><a href="/doctors" class="sidebar__link"><span class="sidebar__link-icon">ğŸ‘¨â€âš•ï¸</span> Doctors</a><a href="/testimonials" class="sidebar__link"><span class="sidebar__link-icon">â­</span> Testimonials</a><div class="sidebar__section">Management</div><a href="/costs" class="sidebar__link"><span class="sidebar__link-icon">ğŸ’°</span> Cost Manager</a><a href="/submissions" class="sidebar__link"><span class="sidebar__link-icon">ğŸ“‹</span> Submissions</a><a href="/static-pages" class="sidebar__link"><span class="sidebar__link-icon">ğŸ“„</span> Static Pages</a><a href="/page-content" class="sidebar__link"><span class="sidebar__link-icon">ğŸ”§</span> Page Content</a><a href="/media" class="sidebar__link"><span class="sidebar__link-icon">ğŸ–¼ï¸</span> Media Library</a><div class="sidebar__section">Tools</div><a href="/ai-assistant" class="sidebar__link"><span class="sidebar__link-icon">ğŸ¤–</span> Claude AI</a><a href="/users" class="sidebar__link"><span class="sidebar__link-icon">ğŸ‘¥</span> Users</a><a href="/settings" class="sidebar__link"><span class="sidebar__link-icon">âš™ï¸</span> Settings</a></nav><div class="sidebar__footer"><div class="sidebar__user"><div class="sidebar__user-avatar" id="userAvatar">SA</div><div class="sidebar__user-info"><div class="sidebar__user-name" id="userName">Admin</div><div class="sidebar__user-role" id="userRole">-</div></div></div><a href="/logout" class="sidebar__logout">Logout â†’</a></div></aside>
<main class="main"><header class="topbar"><button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button><h1 class="topbar__title" id="pageTitle">New Blog Post</h1><div class="topbar__actions"><a href="/blog" class="btn btn--outline">â† Back</a><button class="btn btn--outline" onclick="savePost('draft')">ğŸ’¾ Save Draft</button><button class="btn btn--primary" onclick="savePost('published')">ğŸš€ Publish</button></div></header>
<div class="content"><div class="editor-layout"><div class="editor-main">
<div class="form-group"><label class="form-label">Title</label><input type="text" class="form-input" id="title" placeholder="Enter post title..." oninput="generateSlug()" style="font-size:1.2rem;font-weight:600"></div>
<div class="form-row"><div class="form-group"><label class="form-label">URL Slug</label><input type="text" class="form-input" id="slug" placeholder="post-url-slug"></div><div class="form-group"><label class="form-label">Category</label><select class="form-select" id="category"><option value="">Select</option><option>Guide</option><option>Cost</option><option>Treatment</option><option>Patient Story</option><option>News</option><option>Tips</option></select></div></div>
<div class="form-group"><label class="form-label">Excerpt</label><textarea class="form-textarea" id="excerpt" style="min-height:70px" placeholder="Brief summary for listings and SEO..."></textarea></div>
<div class="form-group"><label class="form-label">Content</label><div id="editor"></div><div class="word-count" id="wordCount">0 words</div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Meta Title (SEO)</label><input type="text" class="form-input" id="metaTitle" placeholder="SEO title â€” leave blank to use post title"></div><div class="form-group"><label class="form-label">Read Time (min)</label><input type="number" class="form-input" id="readTime" placeholder="10"></div></div>
<div class="form-group"><label class="form-label">Meta Description (SEO)</label><textarea class="form-textarea" id="metaDesc" style="min-height:60px" placeholder="SEO description â€” leave blank to use excerpt"></textarea></div>
<div class="form-group"><label class="form-label">Cover Image URL</label><input type="text" class="form-input" id="coverImage" placeholder="https://..."></div>
</div>
<div class="ai-panel"><div class="ai-panel__header">ğŸ¤– Claude AI Writer</div><div class="ai-panel__body">
<div class="form-group"><label class="form-label">What do you need?</label><textarea class="form-textarea" id="aiPrompt" style="min-height:80px" placeholder="e.g. Write a 1500-word blog about knee replacement in India..."></textarea></div>
<button class="btn btn--teal ai-btn" onclick="aiGenerate('blog')">âœ¨ Generate with Claude</button>
<button class="btn btn--outline ai-btn" onclick="aiGenerate('blog','Improve this content for SEO:\n'+quill.root.innerHTML.substring(0,1000))">ğŸ“ˆ Improve SEO</button>
<button class="btn btn--outline ai-btn" onclick="aiGenerate('blog','Generate meta title and description for: '+document.getElementById('title').value)">ğŸ·ï¸ Generate Meta Tags</button>
<div class="ai-output" id="aiOutput"></div>
<button class="btn btn--primary ai-btn" id="useContentBtn" style="display:none" onclick="useAIContent()">ğŸ“‹ Insert into Editor</button>
</div></div></div></div></main></div>

<script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
// Initialize Quill editor
const quill = new Quill('#editor', {
    theme: 'snow',
    placeholder: 'Write your blog post here...',
    modules: {
        toolbar: [
            [{ 'header': [1, 2, 3, false] }],
            ['bold', 'italic', 'underline', 'strike'],
            [{ 'color': [] }, { 'background': [] }],
            [{ 'list': 'ordered'}, { 'list': 'bullet' }],
            ['blockquote', 'code-block'],
            ['link', 'image'],
            [{ 'align': [] }],
            ['clean']
        ]
    }
});

// Word count
quill.on('text-change', () => {
    const text = quill.getText().trim();
    const words = text ? text.split(/\s+/).length : 0;
    document.getElementById('wordCount').textContent = words + ' words';
});

const editId = window.location.pathname.includes('/edit/') ? window.location.pathname.split('/edit/')[1] : null;
if (editId) loadPost();

async function loadPost() {
    const r = await fetch('/api/blog/' + editId); const p = await r.json();
    document.getElementById('title').value = p.title || '';
    document.getElementById('slug').value = p.slug || '';
    document.getElementById('category').value = p.category || '';
    document.getElementById('excerpt').value = p.excerpt || '';
    quill.root.innerHTML = p.content || '';
    document.getElementById('metaTitle').value = p.meta_title || '';
    document.getElementById('metaDesc').value = p.meta_description || '';
    document.getElementById('readTime').value = p.read_time || '';
    document.getElementById('coverImage').value = p.cover_image || '';
    document.getElementById('pageTitle').textContent = 'Edit: ' + p.title;
}

function generateSlug() {
    const title = document.getElementById('title').value;
    document.getElementById('slug').value = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
}

async function savePost(status) {
    const data = {
        title: document.getElementById('title').value,
        slug: document.getElementById('slug').value,
        category: document.getElementById('category').value,
        excerpt: document.getElementById('excerpt').value,
        content: quill.root.innerHTML,
        meta_title: document.getElementById('metaTitle').value,
        meta_description: document.getElementById('metaDesc').value,
        read_time: parseInt(document.getElementById('readTime').value) || null,
        cover_image: document.getElementById('coverImage').value,
        status
    };
    const url = editId ? '/api/blog/' + editId : '/api/blog';
    const method = editId ? 'PUT' : 'POST';
    try {
        const r = await fetch(url, { method, headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(data) });
        if (r.ok) { alert('Post saved!'); window.location.href = '/blog'; }
        else { const e = await r.json(); alert('Error: ' + e.error); }
    } catch (e) { alert('Save failed'); }
}

async function aiGenerate(type, customPrompt) {
    const prompt = customPrompt || document.getElementById('aiPrompt').value;
    if (!prompt) { alert('Enter a prompt first'); return; }
    const out = document.getElementById('aiOutput');
    out.style.display = 'block'; out.innerHTML = '<div class="loading">ğŸ¤– Claude is writing...</div>';
    document.getElementById('useContentBtn').style.display = 'none';
    try {
        const r = await fetch('/api/ai/generate', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ prompt, type, context: document.getElementById('title').value }) });
        const data = await r.json();
        if (r.ok) { out.innerHTML = data.content.replace(/\n/g, '<br>'); document.getElementById('useContentBtn').style.display = 'block'; }
        else { out.innerHTML = 'Error: ' + data.error; }
    } catch (e) { out.innerHTML = 'Failed to connect to AI'; }
}

function useAIContent() {
    const content = document.getElementById('aiOutput').innerHTML;
    quill.root.innerHTML = content;
    alert('Content added to editor!');
}

// Load user
(async()=>{try{const r=await fetch('/api/auth/me');if(!r.ok)return window.location.href='/login';const u=await r.json();document.getElementById('userName').textContent=u.name;document.getElementById('userRole').textContent=u.role.replace('_',' ').toUpperCase();document.getElementById('userAvatar').textContent=u.name.split(' ').map(n=>n[0]).join('')}catch(e){window.location.href='/login'}})();
</script></body></html>
