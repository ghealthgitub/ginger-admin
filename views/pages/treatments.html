<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Treatments | Ginger Admin</title><link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/admin.css"><link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<style>.ql-editor{min-height:150px;font-size:.92rem;line-height:1.7;font-family:"DM Sans",sans-serif}.ql-toolbar{border-color:var(--gray-200)!important;background:var(--gray-50);border-radius:8px 8px 0 0}.ql-container{border-color:var(--gray-200)!important;border-radius:0 0 8px 8px}</style>
</head><body><div class="layout"><aside class="sidebar" id="sidebar"></aside>
<main class="main"><header class="topbar"><button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">â˜°</button><h1 class="topbar__title">Treatments & Procedures</h1><div class="topbar__actions"><button class="btn btn--primary" onclick="openModal()">+ Add Treatment</button></div></header><div class="content"><div class="toolbar"><input type="text" class="search-input" placeholder="Search treatments..." id="searchInput" oninput="filter()"><select class="form-select" style="width:auto" id="specFilter" onchange="filter()"><option value="">All Specialties</option></select></div><div class="card"><div class="card__body"><table class="data-table"><thead><tr><th>Treatment</th><th>Specialty</th><th>Cost (USD)</th><th>Duration</th><th>Recovery</th><th>Status</th><th>Actions</th></tr></thead><tbody id="list"><tr><td colspan="7" class="loading">Loading...</td></tr></tbody></table></div></div></div>
<div class="modal-overlay" id="modal"><div class="modal"><div class="modal__header"><h3 id="modalTitle">Add Treatment</h3><button class="modal__close" onclick="closeModal()">âœ•</button></div><div class="modal__body">
<div class="form-group"><label class="form-label">Treatment Name</label><input type="text" class="form-input" id="f_name" oninput="document.getElementById('f_slug').value=this.value.toLowerCase().replace(/[^a-z0-9]+/g,'-')"></div>
<div class="form-row"><div class="form-group"><label class="form-label">Slug</label><input type="text" class="form-input" id="f_slug"></div><div class="form-group"><label class="form-label">Specialty</label><select class="form-select" id="f_specialty"></select></div></div>
<div class="form-group"><label class="form-label">Description</label><textarea class="form-textarea" id="f_desc" style="min-height:60px"></textarea></div>
<div class="form-row"><div class="form-group"><label class="form-label">Cost Range (USD)</label><input type="text" class="form-input" id="f_cost" placeholder="&dollar;3,000 - &dollar;5,000"></div><div class="form-group"><label class="form-label">Duration</label><input type="text" class="form-input" id="f_duration" placeholder="2-3 hours"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Recovery Time</label><input type="text" class="form-input" id="f_recovery" placeholder="6-8 weeks"></div><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f_status"><option value="draft">Draft</option><option value="published">Published</option></select></div></div>
</div><div class="modal__footer"><button class="btn btn--outline" onclick="closeModal()">Cancel</button><button class="btn btn--primary" onclick="saveItem()">Save</button></div></div></div></main></div>
<script>let items=[],specs=[],editId=null;
async function load(){const[r1,r2]=await Promise.all([fetch('/api/treatments'),fetch('/api/specialties')]);items=await r1.json();specs=await r2.json();
const sf=document.getElementById('specFilter');const ff=document.getElementById('f_specialty');sf.innerHTML='<option value="">All Specialties</option>'+specs.map(s=>'<option value="'+s.id+'">'+s.name+'</option>').join('');ff.innerHTML=specs.map(s=>'<option value="'+s.id+'">'+s.name+'</option>').join('');filter()}
function filter(){const q=document.getElementById('searchInput').value.toLowerCase();const sid=document.getElementById('specFilter').value;const f=items.filter(t=>(t.name.toLowerCase().includes(q))&&(!sid||t.specialty_id==sid));const tb=document.getElementById('list');if(!f.length){tb.innerHTML='<tr><td colspan="7" class="empty-state">No treatments</td></tr>';return}
tb.innerHTML=f.map(t=>'<tr><td><strong>'+t.name+'</strong></td><td>'+(t.specialty_name||'-')+'</td><td>'+(t.cost_range_usd||'-')+'</td><td>'+(t.duration||'-')+'</td><td>'+(t.recovery_time||'-')+'</td><td><span class="badge badge--'+t.status+'">'+t.status+'</span></td><td><button class="btn btn--outline btn--sm" onclick="editItem('+t.id+')">Edit</button> <button class="btn btn--danger btn--sm" onclick="deleteItem('+t.id+')">ðŸ—‘</button></td></tr>').join('')}
function openModal(){editId=null;document.getElementById('modal').classList.add('open');['f_name','f_slug','f_desc','f_cost','f_duration','f_recovery'].forEach(function(f){document.getElementById(f).value=''})}
function closeModal(){document.getElementById('modal').classList.remove('open')}
function editItem(id){var t=items.find(function(i){return i.id===id});if(!t)return;editId=id;document.getElementById('modal').classList.add('open');document.getElementById('f_name').value=t.name;document.getElementById('f_slug').value=t.slug;document.getElementById('f_specialty').value=t.specialty_id||'';document.getElementById('f_desc').value=t.description||'';document.getElementById('f_cost').value=t.cost_range_usd||'';document.getElementById('f_duration').value=t.duration||'';document.getElementById('f_recovery').value=t.recovery_time||'';document.getElementById('f_status').value=t.status}
async function saveItem(){var data={name:document.getElementById('f_name').value,slug:document.getElementById('f_slug').value,specialty_id:parseInt(document.getElementById('f_specialty').value)||null,description:document.getElementById('f_desc').value,cost_range_usd:document.getElementById('f_cost').value,duration:document.getElementById('f_duration').value,recovery_time:document.getElementById('f_recovery').value,status:document.getElementById('f_status').value};
var url=editId?'/api/treatments/'+editId:'/api/treatments';var method=editId?'PUT':'POST';var r=await fetch(url,{method:method,headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load()}else{alert('Error')}}
async function deleteItem(id){if(!confirm('Delete?'))return;await fetch('/api/treatments/'+id,{method:'DELETE'});load()}
load();</script><script src="https://cdn.quilljs.com/1.3.7/quill.min.js"></script>
<script>
let quillDesc;
function initQuill(){if(quillDesc)return;quillDesc=new Quill('#f_longdesc_editor',{theme:'snow',placeholder:'Detailed description...',modules:{toolbar:[['bold','italic','underline'],[{'header':[2,3,false]}],[{'list':'ordered'},{'list':'bullet'}],['link'],['clean']]}})}
const origOpen=openModal;openModal=function(){origOpen();setTimeout(initQuill,100)};
const origEdit=editItem;editItem=function(id){origEdit(id);setTimeout(()=>{initQuill();const s=items.find(i=>i.id===id);if(s&&quillDesc)quillDesc.root.innerHTML=s.long_description||''},150)};
const origSave=saveItem;saveItem=async function(){const data={name:document.getElementById('f_name').value,slug:document.getElementById('f_slug').value,specialty_id:parseInt(document.getElementById('f_specialty').value)||null,description:document.getElementById('f_desc').value,long_description:quillDesc?quillDesc.root.innerHTML:'',duration:document.getElementById('f_duration').value,recovery_time:document.getElementById('f_recovery').value,cost_range_usd:document.getElementById('f_cost').value,status:document.getElementById('f_status').value,is_featured:document.getElementById('f_featured')?document.getElementById('f_featured').value==='true':false};const url=editId?'/api/treatments/'+editId:'/api/treatments';const method=editId?'PUT':'POST';const r=await fetch(url,{method,headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load()}else{const e=await r.json();alert(e.error)}};
</script>
<script src="/js/sidebar.js"></script>
</body></html>