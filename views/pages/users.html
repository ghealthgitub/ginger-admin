<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Users | Ginger Admin</title><link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=Playfair+Display:wght@600;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="/css/admin.css"><script src="/js/sidebar.js" defer></script>
</head><body><div class="layout"><aside class="sidebar" id="sidebar"></aside>
<main class="main"><header class="topbar"><button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">☰</button><h1 class="topbar__title">Users</h1><div class="topbar__actions"><button class="btn btn--primary" onclick="openModal()">+ Add User</button></div></header><div class="content"><div class="card"><div class="card__body"><table class="data-table"><thead><tr><th>Name</th><th>Email</th><th>Role</th><th>Status</th><th>Last Login</th><th>Actions</th></tr></thead><tbody id="list"><tr><td colspan="6" class="loading">Loading...</td></tr></tbody></table></div></div></div>
<div class="modal-overlay" id="modal"><div class="modal"><div class="modal__header"><h3 id="modalTitle">Add User</h3><button class="modal__close" onclick="closeModal()">✕</button></div><div class="modal__body">
<div class="form-row"><div class="form-group"><label class="form-label">Full Name</label><input type="text" class="form-input" id="f_name"></div><div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="f_email"></div></div>
<div class="form-row"><div class="form-group"><label class="form-label">Password <span id="passHint" style="font-weight:400;color:var(--gray-400)">(min 8 chars)</span></label><input type="password" class="form-input" id="f_pass" placeholder="Min 8 characters"></div><div class="form-group"><label class="form-label">Role</label><select class="form-select" id="f_role"><option value="viewer">Viewer</option><option value="editor">Editor</option><option value="super_admin">Super Admin</option></select></div></div>
<div class="form-row" id="activeRow" style="display:none"><div class="form-group"><label class="form-label">Status</label><select class="form-select" id="f_active"><option value="true">Active</option><option value="false">Inactive</option></select></div><div class="form-group"></div></div>
</div><div class="modal__footer"><button class="btn btn--outline" onclick="closeModal()">Cancel</button><button class="btn btn--primary" onclick="saveUser()">Save</button></div></div></div></main></div>
<script>let users=[],editId=null;
async function load(){try{const r=await fetch('/api/users');if(!r.ok)return;users=await r.json();const tb=document.getElementById('list');
tb.innerHTML=users.map(u=>`<tr><td><strong>${u.name}</strong></td><td>${u.email}</td><td><span class="badge" style="background:${u.role==='super_admin'?'#DBEAFE':u.role==='editor'?'#D1FAE5':'#F3F4F6'};color:${u.role==='super_admin'?'#1E40AF':u.role==='editor'?'#065F46':'#374151'}">${u.role.replace('_',' ')}</span></td><td>${u.is_active?'<span style="color:#059669">✅ Active</span>':'<span style="color:#DC2626">❌ Inactive</span>'}</td><td style="font-size:.82rem;color:var(--gray-400)">${u.last_login?new Date(u.last_login).toLocaleDateString():'Never'}</td><td><button class="btn btn--outline btn--sm" onclick="editUser(${u.id})">✏️ Edit</button></td></tr>`).join('')}catch(e){console.error(e)}}

function openModal(){editId=null;document.getElementById('modal').classList.add('open');document.getElementById('modalTitle').textContent='Add User';['f_name','f_email','f_pass'].forEach(f=>document.getElementById(f).value='');document.getElementById('f_role').value='editor';document.getElementById('f_pass').placeholder='Min 8 characters';document.getElementById('passHint').textContent='(min 8 chars)';document.getElementById('activeRow').style.display='none'}

function editUser(id){const u=users.find(x=>x.id===id);if(!u)return;editId=id;document.getElementById('modal').classList.add('open');document.getElementById('modalTitle').textContent='Edit User: '+u.name;document.getElementById('f_name').value=u.name;document.getElementById('f_email').value=u.email;document.getElementById('f_role').value=u.role;document.getElementById('f_pass').value='';document.getElementById('f_pass').placeholder='Leave blank to keep current';document.getElementById('passHint').textContent='(leave blank to keep current)';document.getElementById('activeRow').style.display='';document.getElementById('f_active').value=u.is_active?'true':'false'}

function closeModal(){document.getElementById('modal').classList.remove('open');editId=null}

async function saveUser(){const data={name:document.getElementById('f_name').value,email:document.getElementById('f_email').value,role:document.getElementById('f_role').value};
if(!data.name||!data.email){alert('Name and email are required');return}
const pw=document.getElementById('f_pass').value;
if(editId){data.is_active=document.getElementById('f_active').value==='true';if(pw)data.password=pw;
const r=await fetch('/api/users/'+editId,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load()}else{const e=await r.json();alert('Error: '+(e.error||'Save failed'))}}
else{if(!pw||pw.length<8){alert('Password is required (min 8 characters)');return}data.password=pw;
const r=await fetch('/api/users',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(data)});if(r.ok){closeModal();load()}else{const e=await r.json();alert('Error: '+(e.error||'Save failed'))}}}
load();
</script>
</body></html>
