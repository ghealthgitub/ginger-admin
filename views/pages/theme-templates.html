<!DOCTYPE html><html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Theme Templates | Ginger Admin</title>
<link rel="stylesheet" href="/css/admin.css">
<script src="/js/sidebar.js" defer></script>
<style>
.tt-page{max-width:1200px;margin:0 auto;padding:24px}
.tt-tabs{display:flex;gap:4px;overflow-x:auto;padding-bottom:2px;border-bottom:2px solid #F3F4F6;margin-bottom:24px}
.tt-tab{padding:10px 18px;font-size:.85rem;font-weight:500;color:#6B7280;border-radius:8px 8px 0 0;cursor:pointer;white-space:nowrap;transition:all .2s;border:none;background:none;border-bottom:2px solid transparent;margin-bottom:-2px}
.tt-tab:hover{color:#0B2545;background:#F9FAFB}
.tt-tab.active{color:#0EA5A0;border-bottom-color:#0EA5A0;font-weight:600;background:rgba(14,165,160,.05)}
.tt-badge{display:inline-block;background:#E5E7EB;color:#4B5563;font-size:.72rem;padding:1px 6px;border-radius:10px;margin-left:6px}
.tt-tab.active .tt-badge{background:#0EA5A0;color:#fff}
.tt-card{background:#fff;border:1px solid #E5E7EB;border-radius:12px;overflow:hidden;margin-bottom:20px}
.tt-hdr{padding:16px 20px;border-bottom:1px solid #F3F4F6;display:flex;justify-content:space-between;align-items:center}
.tt-hdr-title{font-weight:600;color:#0B2545}
.tt-hdr-desc{font-size:.82rem;color:#9CA3AF;margin-top:2px}
.tt-hdr-acts{display:flex;gap:8px;align-items:center}
.tt-vars{background:#F9FAFB;border-bottom:1px solid #F3F4F6;padding:12px 20px}
.tt-vars b{font-size:.82rem;color:#0B2545;margin-right:8px}
.tt-var{display:inline-block;background:#fff;border:1px solid #E5E7EB;padding:3px 8px;border-radius:5px;font-size:.75rem;font-family:monospace;color:#4B5563;cursor:pointer;margin:2px;transition:all .15s}
.tt-var:hover{background:#0EA5A0;color:#fff;border-color:#0EA5A0}
.tt-editor textarea{width:100%;min-height:350px;font-family:'Consolas','Monaco',monospace;font-size:.82rem;line-height:1.6;padding:16px 20px;border:none;outline:none;resize:vertical;background:#1e1e2e;color:#cdd6f4;display:block;box-sizing:border-box}
.tt-css-hdr{padding:6px 20px;background:#F9FAFB;font-size:.78rem;color:#6B7280;font-weight:600;border-top:1px solid #E5E7EB}
.tt-css textarea{min-height:100px}
.tt-foot{padding:10px 20px;border-top:1px solid #F3F4F6;display:flex;justify-content:space-between;font-size:.82rem;color:#9CA3AF}
.tt-saved{color:#059669;font-weight:600;display:none}
.tt-toggle{position:relative;width:42px;height:22px;border-radius:11px;background:#D1D5DB;cursor:pointer;transition:background .2s;flex-shrink:0}
.tt-toggle.on{background:#0EA5A0}
.tt-toggle::after{content:'';position:absolute;top:2px;left:2px;width:18px;height:18px;border-radius:50%;background:#fff;transition:left .2s;box-shadow:0 1px 3px rgba(0,0,0,.15)}
.tt-toggle.on::after{left:22px}
.btn-save{background:#0EA5A0;color:#fff;border:none;padding:8px 20px;border-radius:8px;font-weight:600;font-size:.82rem;cursor:pointer}
.btn-save:hover{background:#0c918c}
.btn-rst{background:transparent;color:#6B7280;border:1px solid #E5E7EB;padding:6px 14px;border-radius:8px;font-size:.8rem;cursor:pointer}
.btn-rst:hover{background:#F9FAFB}
.tt-info{background:#EFF6FF;border:1px solid #BFDBFE;border-radius:8px;padding:14px 16px;font-size:.85rem;color:#1E40AF;margin-bottom:20px;line-height:1.6}
</style>
</head><body>
<aside class="sidebar" id="sidebar"></aside>
<main class="main">
<header class="topbar">
    <button class="topbar__menu" onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>
    <h1 class="topbar__title">üé® Theme Templates</h1>
    <div class="topbar__actions">
        <a href="https://ginger.healthcare/?bypass=ginger2026" target="_blank" class="btn btn--teal" style="font-size:.82rem">üåê Preview Site</a>
    </div>
</header>
<div class="tt-page">

<div class="tt-info">
    <strong>üé® Theme Templates</strong> control the layout of every page on your website ‚Äî like Elementor's Theme Builder.
    Edit a template here, and it instantly applies to <strong>all pages</strong> of that type.
    Use <code style="background:rgba(0,0,0,.06);padding:2px 6px;border-radius:4px">{{ variable }}</code> placeholders for dynamic content. Click any variable tag to copy it.
</div>

<div class="tt-tabs">
    <button class="tt-tab active" onclick="switchCat('detail',this)">üìÑ Detail Pages <span class="tt-badge">6</span></button>
    <button class="tt-tab" onclick="switchCat('listing',this)">üìã Listing Pages <span class="tt-badge">4</span></button>
    <button class="tt-tab" onclick="switchCat('page',this)">üìù Static Pages <span class="tt-badge">3</span></button>
</div>

<div id="container"></div>

</div>
</main>
<script>
var curCat = 'detail';
var saved = {};
var T = [
{key:'blog-detail',label:'Blog Post',cat:'detail',icon:'üìù',desc:'Single blog article page',vars:'post.title,post.content,post.excerpt,post.author_name,post.read_time,post.category,post.cover_image'},
{key:'destination-detail',label:'Destination',cat:'detail',icon:'üåç',desc:'Country/destination page with hospitals & doctors',vars:'destination.name,destination.flag,destination.tagline,destination.description,destination.hospital_count,destination.doctor_count,destination.avg_savings,hospitals[],doctors[]'},
{key:'specialty-detail',label:'Specialty',cat:'detail',icon:'üè∑Ô∏è',desc:'Specialty page with treatments listed',vars:'specialty.name,specialty.icon,specialty.description,specialty.long_description,treatments[]'},
{key:'treatment-detail',label:'Treatment',cat:'detail',icon:'üíä',desc:'Treatment page with costs by destination',vars:'treatment.name,treatment.description,treatment.long_description,treatment.cost_range_usd,treatment.duration,treatment.recovery_time,treatment.specialty_icon,costs[]'},
{key:'hospital-detail',label:'Hospital',cat:'detail',icon:'üè•',desc:'Hospital profile page with doctors',vars:'hospital.name,hospital.description,hospital.city,hospital.country,hospital.beds,hospital.established,hospital.rating,hospital.accreditations,doctors[]'},
{key:'doctor-detail',label:'Doctor',cat:'detail',icon:'üë®‚Äç‚öïÔ∏è',desc:'Doctor profile page',vars:'doctor.name,doctor.title,doctor.specialty,doctor.experience_years,doctor.description,doctor.qualifications,doctor.hospital_name,doctor.hospital_slug'},
{key:'blog-list',label:'Blog Listing',cat:'listing',icon:'üìù',desc:'Blog index page with all posts',vars:'posts[].title,posts[].slug,posts[].excerpt,posts[].category,posts[].read_time'},
{key:'destinations-list',label:'Destinations Listing',cat:'listing',icon:'üåç',desc:'All destinations overview page',vars:'destinations[].name,destinations[].slug,destinations[].flag,destinations[].hospital_count,destinations[].avg_savings'},
{key:'specialties-list',label:'Specialties Listing',cat:'listing',icon:'üè∑Ô∏è',desc:'All specialties overview page',vars:'specialties[].name,specialties[].slug,specialties[].icon'},
{key:'results',label:'Results / Testimonials',cat:'listing',icon:'‚≠ê',desc:'Patient testimonials page',vars:'testimonials[].patient_name,testimonials[].quote,testimonials[].rating,testimonials[].specialty,testimonials[].destination'},
{key:'get-quote',label:'Get Quote Form',cat:'page',icon:'üìã',desc:'Multi-step quote request form',vars:'treatments[],destinations[],specialties[]'},
{key:'cost-calculator',label:'Cost Calculator',cat:'page',icon:'üßÆ',desc:'Interactive cost calculator page',vars:'treatments[],destinations[]'},
{key:'contact',label:'Contact Page',cat:'page',icon:'üìû',desc:'Contact us page with form',vars:''}
];

function switchCat(cat, el) {
    curCat = cat;
    document.querySelectorAll('.tt-tab').forEach(function(t){t.classList.remove('active')});
    el.classList.add('active');
    render();
}

function esc(s) {
    var d = document.createElement('div');
    d.textContent = s || '';
    return d.innerHTML;
}

function render() {
    var c = document.getElementById('container');
    var h = '';
    for (var i = 0; i < T.length; i++) {
        var t = T[i];
        if (t.cat !== curCat) continue;
        var s = saved[t.key];
        var html = s ? s.html_template : (t.defaultHtml || '<!-- Edit this template for ' + t.label + ' pages -->');
        var css = s ? (s.css || '') : '';
        var on = s ? s.is_active : true;
        var when = s ? new Date(s.updated_at).toLocaleString() : 'Never (using default)';
        var vars = t.vars ? t.vars.split(',') : [];

        h += '<div class="tt-card" id="card-' + t.key + '">';

        // Header
        h += '<div class="tt-hdr"><div>';
        h += '<div class="tt-hdr-title">' + t.icon + ' ' + t.label + '</div>';
        h += '<div class="tt-hdr-desc">' + t.desc + '</div>';
        h += '</div><div class="tt-hdr-acts">';
        h += '<div class="tt-toggle' + (on ? ' on' : '') + '" onclick="this.classList.toggle(\'on\')"></div>';
        h += '<button class="btn-save" onclick="doSave(\'' + t.key + '\')">üíæ Save</button>';
        if (s) h += ' <button class="btn-rst" onclick="doReset(\'' + t.key + '\')">‚Ü© Reset</button>';
        h += '</div></div>';

        // Variables
        if (vars.length > 0 && vars[0]) {
            h += '<div class="tt-vars"><b>Variables:</b>';
            for (var v = 0; v < vars.length; v++) {
                h += '<span class="tt-var" onclick="cpVar(\'' + vars[v] + '\',this)">{{ ' + vars[v] + ' }}</span>';
            }
            h += '</div>';
        }

        // HTML Editor
        h += '<div class="tt-editor"><textarea id="html-' + t.key + '" placeholder="Enter HTML template...">' + esc(html) + '</textarea></div>';

        // CSS Editor
        h += '<div class="tt-css-hdr">Custom CSS (optional)</div>';
        h += '<div class="tt-editor tt-css"><textarea id="css-' + t.key + '" placeholder="/* Custom CSS */">' + esc(css) + '</textarea></div>';

        // Footer
        h += '<div class="tt-foot"><span>Last saved: ' + when + '</span><span class="tt-saved" id="sv-' + t.key + '">‚úÖ Saved!</span></div>';
        h += '</div>';
    }
    c.innerHTML = h;
}

async function doSave(key) {
    var t = T.find(function(x){return x.key===key});
    var htmlVal = document.getElementById('html-' + key).value;
    var cssVal = document.getElementById('css-' + key).value;
    var card = document.getElementById('card-' + key);
    var on = card.querySelector('.tt-toggle').classList.contains('on');
    try {
        var r = await fetch('/api/theme-templates/' + key, {
            method: 'PUT',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ label:t.label, category:t.cat, description:t.desc, html_template:htmlVal, css:cssVal, is_active:on })
        });
        if (r.ok) {
            var d = await r.json();
            saved[key] = d;
            var el = document.getElementById('sv-' + key);
            el.style.display = 'inline';
            setTimeout(function(){el.style.display='none'},3000);
        } else { alert('Save failed'); }
    } catch(e) { alert('Error: ' + e.message); }
}

async function doReset(key) {
    if (!confirm('Reset to default? Your custom changes will be lost.')) return;
    try {
        await fetch('/api/theme-templates/' + key, {method:'DELETE'});
        delete saved[key];
        render();
    } catch(e) { alert('Error: ' + e.message); }
}

function cpVar(v, el) {
    navigator.clipboard.writeText('{{' + v + '}}');
    el.style.background = '#0EA5A0';
    el.style.color = '#fff';
    el.style.borderColor = '#0EA5A0';
    setTimeout(function(){el.style.background='';el.style.color='';el.style.borderColor=''},800);
}

// Load saved templates then render
(async function(){
    try {
        var r = await fetch('/api/theme-templates');
        if (r.ok) {
            var data = await r.json();
            data.forEach(function(t){saved[t.template_key]=t});
        }
    } catch(e) { console.log('Templates API not available yet'); }
    render();
})();
</script>
</body></html>
